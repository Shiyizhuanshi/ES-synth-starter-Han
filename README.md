# ES-synth-starter

  Use this project as the starting point for your Embedded Systems labs and coursework.
  
  [Lab Part 1](doc/LabPart1.md)
  
  [Lab Part 2](doc/LabPart2.md)

## Additional Information

  [Handshaking and auto-detection](doc/handshaking.md)
  
  [Double buffering of audio samples](doc/doubleBuffer.md)

  [StackSynth V1.1 Schematic](doc/StackSynth-v1.pdf)

  [StackSynth V2.1 Schematic](doc/StackSynth-v2.pdf)

Taskes:

BackgroundCalc Task:

sampleISQ:



Implemented features:

-Polyphony: 
  1. Added notes data structure, that stores wether a key has been pressed, and the octave of the pressed key, and the key's phase accumulator. (need to change this to 96 member array, with index of 12*octave-1+notenum, if there are 8 octaves)
  2. BackgroundCalc task contains a local static variable to keep track of a sum of different post-processing amplitudes of keys pressed, and an average is taken, and that is the polyphnied sound
  3. For sawtooth waves, averaging amplitude is the same as averaging frequency, because the phase accumulator is the amplitude itself.
-Autodetection
![e75e0b95f9aa83c1c47cc2dcc30fac2](https://github.com/Shiyizhuanshi/ES-synth-starter-Han/assets/105670417/e80f9770-9213-4a2c-adbb-cba2052ff9ef)
1. Once connected, autodetection takes place to confirm the position of the board. The board connected to the usb is the master board, and all other boards will be slave boards.
-Different sounds and LUTs
![25e38a412b3b6df48b0d3b1dc715762](https://github.com/Shiyizhuanshi/ES-synth-starter-Han/assets/105670417/83ed7822-ead8-485d-9f3b-f31c0fd62b3c)
  1. Introduces function that generates sin, square, and triangle waves. Computing their waveform takes too much some and causes deadlocks, pre-written LUT look up tables are introduced to fasten this process. 
  2. Other sounds, such as saxophone, piano, bell like sounds can be generated also using LUTS
  3. Phase step is inputted into the function, and the processed waveform comes out with the desired characteristics
  4. LUT waves sounds similar to synthesized waves. there might be some differences of the note is too high or too low, the LUT table size is not able to diffrentiate between two low keys.
![5252be2a0e88359de5194053ab353a4](https://github.com/Shiyizhuanshi/ES-synth-starter-Han/assets/105670417/7c7762db-00ab-4fee-9e01-06b9bde280aa)
-Low Frequency Oscillator LFO
  1. Low frequency oscillator is generated by injecting a low frequency (<20) sin wave's amplitude into the sound to generate a low oscillating noise to sound more realistic
  2. This sound can be generated before more processing or after processing
   
-Fading, ADSR and Amplitude manipulation
  1. Added PressedCount to the notes struct to count the time of a key being pressed. 
  2. We can fade the key's sound if the key has been pressed for a specified time, like real instruments
  3. We can do further amplitude manipulation using ADSR, which sound increases during attack, decrease in decay, level in sustain and fade in release. We do not plan to linger the sound when a key is released because that causes greater changes in the overall struct, therefore the release part is excuted when some time is met. We can use ADSR to create various sounds.
  4. We can manipulate the amplitude however we like, for example, a emergency alarm sound can be created by changing the amplitude low then high and back and fourth.

-Metronome:
  1. A metronome can be created by displaying a sound onces every some number of cycles, the speed can be changed by changing the nob.
  2. The sound of metronome stays the same regardless of any key has been pressed. 
   
-Filtering:
  1. Filters are implented to get rid of the high frequency components of synthsized waves, so it doesnt sound so horrible
  2. Low pass filters are implemented by taking a derivative, and there are other filters.



